{% extends 'base.html' %}

{% block title %}Modifier mon profil - FocusStudy{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto">
    <div class="bg-white rounded-2xl shadow-2xl p-8">
        <!-- En-tÃªte -->
        <div class="text-center mb-8">
            <div class="text-5xl mb-4">âœï¸</div>
            <h1 class="text-3xl font-bold text-gray-800 mb-2">Modifier mon profil</h1>
            <p class="text-gray-600">Mets Ã  jour tes informations</p>
        </div>

        <!-- Formulaire -->
        <form method="post" enctype="multipart/form-data" class="space-y-6">
            {% csrf_token %}

            <!-- Photo de profil actuelle -->
            <div class="text-center">
                <label class="block text-gray-700 font-medium mb-4">
                    <i class="fas fa-camera mr-1"></i> Photo de profil
                </label>
                <div class="flex justify-center mb-4">
                    {% if user.photo_profil %}
                        <img id="preview" src="{{ user.photo_profil.url }}" alt="Photo actuelle" class="w-32 h-32 rounded-full object-cover border-4 border-purple-200">
                    {% else %}
                        <img id="preview" src="https://via.placeholder.com/150" alt="AperÃ§u" class="w-32 h-32 rounded-full object-cover border-4 border-purple-200">
                    {% endif %}
                </div>
                <div class="flex justify-center">
                    <label for="photo_profil" class="bg-purple-100 text-purple-700 px-4 py-2 rounded-lg cursor-pointer hover:bg-purple-200 transition">
                        <i class="fas fa-upload mr-2"></i> Changer la photo
                    </label>
                    <input type="file" id="photo_profil" name="photo_profil" accept="image/*" class="hidden" onchange="previewImage(event)">
                </div>
            </div>

            <!-- PrÃ©nom et Nom -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-gray-700 font-medium mb-2">
                        <i class="fas fa-user mr-1"></i> PrÃ©nom *
                    </label>
                    <input 
                        type="text" 
                        name="first_name" 
                        value="{{ user.first_name }}"
                        required
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                    >
                </div>
                
                <div>
                    <label class="block text-gray-700 font-medium mb-2">
                        <i class="fas fa-user mr-1"></i> Nom *
                    </label>
                    <input 
                        type="text" 
                        name="last_name" 
                        value="{{ user.last_name }}"
                        required
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                    >
                </div>
            </div>

            <!-- Email -->
            <div>
                <label class="block text-gray-700 font-medium mb-2">
                    <i class="fas fa-envelope mr-1"></i> Email *
                </label>
                <input 
                    type="email" 
                    name="email" 
                    value="{{ user.email }}"
                    required
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                >
            </div>

            <!-- Niveau et Classe -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Niveau -->
                <div>
                    <label class="block text-gray-700 font-medium mb-2">
                        <i class="fas fa-school mr-1"></i> Niveau scolaire *
                    </label>
                    <select 
                        name="niveau" 
                        required
                        id="niveau"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                        onchange="updateClasses()"
                    >
                        <option value="">-- Choisir --</option>
                        <option value="college" {% if user.niveau == 'college' %}selected{% endif %}>CollÃ¨ge</option>
                        <option value="lycee" {% if user.niveau == 'lycee' %}selected{% endif %}>LycÃ©e</option>
                    </select>
                </div>

                <!-- Classe -->
                <div>
                    <label class="block text-gray-700 font-medium mb-2">
                        <i class="fas fa-graduation-cap mr-1"></i> Classe *
                    </label>
                    <select 
                        name="classe" 
                        required
                        id="classe"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                    >
                        <option value="">-- Choisir --</option>
                    </select>
                </div>
            </div>

            <!-- Pays -->
            <div>
                <label class="block text-gray-700 font-medium mb-2">
                    <i class="fas fa-globe-africa mr-1"></i> Pays *
                </label>
                <select 
                    name="pays" 
                    required
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                >
                    <option value="">-- Choisir --</option>
                    <option value="TG" {% if user.pays == 'TG' %}selected{% endif %}>ğŸ‡¹ğŸ‡¬ Togo</option>
                    <option value="BJ" {% if user.pays == 'BJ' %}selected{% endif %}>ğŸ‡§ğŸ‡¯ BÃ©nin</option>
                    <option value="SN" {% if user.pays == 'SN' %}selected{% endif %}>ğŸ‡¸ğŸ‡³ SÃ©nÃ©gal</option>
                    <option value="CI" {% if user.pays == 'CI' %}selected{% endif %}>ğŸ‡¨ğŸ‡® CÃ´te d'Ivoire</option>
                    <option value="BF" {% if user.pays == 'BF' %}selected{% endif %}>ğŸ‡§ğŸ‡« Burkina Faso</option>
                    <option value="ML" {% if user.pays == 'ML' %}selected{% endif %}>ğŸ‡²ğŸ‡± Mali</option>
                    <option value="NE" {% if user.pays == 'NE' %}selected{% endif %}>ğŸ‡³ğŸ‡ª Niger</option>
                    <option value="GN" {% if user.pays == 'GN' %}selected{% endif %}>ğŸ‡¬ğŸ‡³ GuinÃ©e</option>
                </select>
            </div>

            <!-- TÃ©lÃ©phone -->
            <div>
                <label class="block text-gray-700 font-medium mb-2">
                    <i class="fas fa-phone mr-1"></i> TÃ©lÃ©phone (optionnel)
                </label>
                <input 
                    type="tel" 
                    name="telephone"
                    value="{{ user.telephone }}"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                    placeholder="+228 XX XX XX XX"
                >
            </div>

            <!-- Boutons -->
            <div class="flex gap-4">
                <button 
                    type="submit" 
                    class="flex-1 gradient-bg text-white font-bold py-3 px-6 rounded-lg hover:opacity-90 transition transform hover:scale-105 shadow-lg"
                >
                    <i class="fas fa-check mr-2"></i> Enregistrer les modifications
                </button>
                
                <a href="{% url 'accounts:profil' %}" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-3 px-6 rounded-lg transition text-center">
                    <i class="fas fa-times mr-2"></i> Annuler
                </a>
            </div>
        </form>
    </div>
</div>

<script>
    // PrÃ©visualisation de l'image
    function previewImage(event) {
        const preview = document.getElementById('preview');
        const file = event.target.files[0];
        
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                preview.src = e.target.result;
            }
            reader.readAsDataURL(file);
        }
    }

    // Mise Ã  jour dynamique des classes selon le niveau
    function updateClasses() {
        const niveau = document.getElementById('niveau').value;
        const classeSelect = document.getElementById('classe');
        const currentClasse = '{{ user.classe }}';
        
        classeSelect.innerHTML = '<option value="">-- Choisir --</option>';
        
        if (niveau === 'college') {
            classeSelect.innerHTML += `
                <option value="6eme" ${currentClasse === '6eme' ? 'selected' : ''}>6Ã¨me</option>
                <option value="5eme" ${currentClasse === '5eme' ? 'selected' : ''}>5Ã¨me</option>
                <option value="4eme" ${currentClasse === '4eme' ? 'selected' : ''}>4Ã¨me</option>
                <option value="3eme" ${currentClasse === '3eme' ? 'selected' : ''}>3Ã¨me</option>
            `;
        } else if (niveau === 'lycee') {
            classeSelect.innerHTML += `
                <option value="seconde" ${currentClasse === 'seconde' ? 'selected' : ''}>Seconde</option>
                <option value="premiere" ${currentClasse === 'premiere' ? 'selected' : ''}>PremiÃ¨re</option>
                <option value="terminale" ${currentClasse === 'terminale' ? 'selected' : ''}>Terminale</option>
            `;
        }
    }
    
    // Initialiser les classes au chargement de la page
    window.onload = function() {
        updateClasses();
    };
</script>
{% endblock %}